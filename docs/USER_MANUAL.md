# お絵描きバトラー (Oekaki Battler) - ユーザーマニュアル

## 目次
1. [概要](#概要)
2. [システム要件](#システム要件)
3. [初期設定](#初期設定)
4. [基本的な使い方](#基本的な使い方)
5. [キャラクター登録](#キャラクター登録)
6. [バトルシステム](#バトルシステム)
   - [ストーリーモード](#5-ストーリーモード)
7. [統計と履歴](#統計と履歴)
8. [トラブルシューティング](#トラブルシューティング)
9. [FAQ](#faq)

---

## 概要

**お絵描きバトラー**は、手描きキャラクターを使った自動対戦ゲームシステムです。あなたが紙に描いたキャラクターをスキャンし、AIが見た目を分析してゲーム用のステータスを自動生成します。その後、キャラクター同士が画面上で自動的にバトルを行います。

### 主な機能
- 🎨 手描きキャラクターの取り込み
- 🤖 AI による自動ステータス生成
- ⚔️ リアルタイム自動バトル表示
- 📖 ストーリーモード（Lv1～Lv5のボス戦）
- 📊 詳細な戦績管理
- 🎲 ランダムマッチ機能

---

## システム要件

### 必要環境
- **Python**: 3.11以上
- **OS**: Windows 10/11, macOS 10.14+, Linux
- **メモリ**: 4GB以上推奨
- **ストレージ**: 1GB以上の空き容量

### 推奨環境
- **Python**: 3.11+
- **メモリ**: 8GB以上
- **グラフィック**: 統合グラフィックス以上
- **スキャナー**: 手描きイラスト用（オプション）

---

## 初期設定

### 1. 依存関係のインストール

```bash
# 仮想環境の有効化
source .venv/bin/activate  # Linux/Mac
# または
.venv\Scripts\activate     # Windows

# パッケージのインストール
pip install -r requirements.txt
```

### 2. 環境変数の設定

`.env`ファイルを作成し、Google AI APIキーを設定してください：

```env
GOOGLE_API_KEY=your_google_api_key_here
MODEL_NAME=gemini-2.5-flash-lite-preview-06-17
```

**APIキーの取得方法：**
1. [Google AI Studio](https://aistudio.google.com/)にアクセス
2. APIキーを生成
3. `.env`ファイルに設定

### 3. アプリケーションの起動

```bash
python main.py
```

初回起動時、データベースが自動的に初期化されます。

---

## 基本的な使い方

### メイン画面の構成

アプリケーション起動後、以下の画面が表示されます：

```
┌─────────────────────────────────────────────────────────┐
│               🎨 お絵描きバトラー                        │
├─────────────┬──────────────────────┬──────────────────────┤
│  Actions    │     Characters       │    Battle Arena      │
│             │                      │                      │
│ 📷 Register │  [Character List]    │  Fighter 1: [____]  │
│ 📊 Stats    │  Name | HP | ATK...  │        🆚            │
│ 🏟️ History  │  ─────┼────┼────     │  Fighter 2: [____]  │
│ ⚙️ Settings │  Char1│100 │ 75      │                      │
│             │  Char2│ 90 │ 85      │  ⚔️ START BATTLE!   │
│ 🔗 Test AI  │  ...  │... │...      │  🎲 Random Battle    │
│ 🔄 Refresh  │                      │                      │
│             │  Description: [___]  │ ☑ Visual Mode       │
└─────────────┴──────────────────────┴──────────────────────┘
│                    Status Bar                              │
└─────────────────────────────────────────────────────────┘
```

### 主要ボタンの説明

- **📷 Register Character**: 新しいキャラクターを登録
- **📊 View Statistics**: 統計情報を表示
- **🏟️ Battle History**: 過去の戦闘履歴を表示
- **⚙️ Settings**: 設定画面を開く
- **🔗 Test AI Connection**: AI接続をテスト
- **🔄 Refresh**: キャラクター一覧を更新

---

## キャラクター登録

### 1. 手描きキャラクターの準備

最適な結果を得るために、以下のガイドラインに従ってください：

**推奨する描き方：**
- ✅ 白い紙に黒いペンで描く
- ✅ キャラクターを中央に大きく描く
- ✅ 輪郭をはっきりと描く
- ✅ 武器や特徴的な装備を含める
- ✅ 正面または斜め向きで描く

**避けるべき描き方：**
- ❌ 背景を複雑に描く
- ❌ キャラクターが小さすぎる
- ❌ 線が薄すぎる、または不明瞭
- ❌ 複数のキャラクターを一枚に描く

### 2. 画像の取り込み

**方法1: スキャナーを使用**
1. 300dpi以上でスキャン
2. PNG またはJPEG形式で保存
3. ファイル名は英数字を使用

**方法2: スマートフォンで撮影**
1. 十分な明るさで撮影
2. 正面から撮影（斜めにならないように）
3. 影が映らないように注意
4. 高解像度で撮影

### 3. キャラクター登録手順

1. **「📷 Register Character」**ボタンをクリック
2. **「Browse」**ボタンで画像ファイルを選択
3. **キャラクター名**を入力（日本語OK）
4. **「Analyze Image」**をクリックしてAI分析実行
5. **生成されたステータス**を確認
6. **説明文**を必要に応じて修正
7. **「Register」**をクリックして登録完了

### 4. ステータスの見方

AIが生成するステータス：

- **HP（体力）**: 10-200の範囲
  - キャラクターの大きさや頑丈さから判定
- **Attack（攻撃力）**: 10-150の範囲
  - 武器の有無や筋肉質な描写から判定
- **Defense（防御力）**: 10-100の範囲
  - 鎧や盾などの防具から判定
- **Speed（素早さ）**: 10-100の範囲
  - 体型のスリムさや手足の長さから判定
- **Magic（魔法力）**: 10-100の範囲
  - 杖や魔法的な装飾から判定
- **Luck（運）**: 0-100の範囲
  - 幸運のシンボル、明るい表情、キラキラした装飾から判定
  - 相手の命中率を下げ、自分のクリティカル率を上げる

**ステータス合計制限**: 全ステータスの合計は最大350まで

---

## バトルシステム

### 1. バトルの準備

1. **Fighter 1**と**Fighter 2**をドロップダウンから選択
2. **Visual Mode**のチェックボックスで表示モードを選択
   - ☑️ Visual Mode: リアルタイムバトル画面表示
   - ☐ Visual Mode: バックグラウンドで高速実行
3. **「⚔️ START BATTLE!」**をクリック

### 2. バトルルール

**基本システム：**
- ターン制の自動戦闘
- 素早さが高いキャラクターが先攻
- 最大50ターンまたは片方のHPが0で終了

**攻撃の種類：**
- **物理攻撃**: Attack値によるダメージ、Defenseで軽減
- **魔法攻撃**: Magic値によるダメージ、Defense無視
- **クリティカル**: 5%の確率で2倍ダメージ（運が高いと確率上昇、最大+30%）
- **ガードブレイク**: 15%の確率で相手の防御力を完全無視（物理攻撃のみ、運が高いと確率上昇、最大+15%）
- **回避**: Speed差により回避の可能性（相手の運が高いと命中率低下、最大-30%）

**運（Luck）の効果：**
- 防御時: 相手の攻撃が外れやすくなる（運100で命中率-30%）
- 攻撃時: クリティカルヒットが出やすくなる（運100でクリティカル率+30%）
- 攻撃時: ガードブレイクが出やすくなる（運100でガードブレイク率+15%、最大30%）

**ガードブレイクについて：**
- 物理攻撃のみ発動（魔法攻撃は対象外）
- 発動すると相手の防御力を完全に無視（Defense = 0）
- クリティカルヒットと同時発動可能
- 画面には青い爆発エフェクトと「🛡️💥ガードブレイク！」のメッセージが表示される

**勝利条件：**
1. 相手のHPを0にする
2. 50ターン経過時のHP多い方
3. HP同値の場合は引き分け

### 3. バトル画面の見方

Visual Mode有効時の画面構成：

```
┌─────────────────────────────────────────────────┐
│           Battle Arena                          │
│                                                │
│  [Char1]     🆚     [Char2]                   │
│  ████████           ████████                   │
│  HP: 85/100         HP: 92/100                │
│  Fighter A          Fighter B                  │
│                                                │
│  Recent Actions:                               │
│  • Fighter A attacks Fighter B for 15 damage  │
│  • Fighter B critical hit! 28 damage!         │
│  • Fighter A uses magic attack                 │
└─────────────────────────────────────────────────┘
```

**表示要素：**
- キャラクター表示（色はHP残量で変化）
- HPバー（緑→黄→赤で変化）
- リアルタイムバトルログ
- 攻撃エフェクト表示

### 4. ランダムバトル

**「🎲 Random Battle」**ボタンで、登録されたキャラクターの中からランダムに2体を選んで戦わせることができます。

### 5. ストーリーモード

**ストーリーモード**では、Lv1～Lv5の固定ボスに順番に挑戦し、最終ボスを倒してクリアを目指します。

#### 5-1. ストーリーモードの開始

1. メニューバーから**「Game」→「Story Mode」**を選択
2. プレイヤーキャラクターを選択
3. 現在のレベルと進行状況を確認
4. **「Start Story Mode」**をクリック

#### 5-2. ストーリーモードの仕様

**基本ルール：**
- Lv1のボスから順番に挑戦
- 一度開始すると、敗北またはクリアまでノンストップで進行
- 各バトル前に挑戦確認ウィンドウが表示される（2秒間）
- 勝利すると自動的に次のレベルへ進行
- 敗北するとストーリーモード終了

**進行状況の保存：**
- キャラクターごとに進行状況が自動保存される
- 撃破済みボスは記録される
- 挑戦回数が記録される
- 最終プレイ日時が保存される

**クリア条件：**
- Lv5のボスを倒すと完全クリア
- クリア後も再挑戦可能

#### 5-3. ボス管理

ストーリーモード用のボスは専用UIで作成・編集できます。

1. メニューバーから**「Game」→「Story Boss Manager」**を選択
2. 左側のパネルからレベル（Lv1～Lv5）を選択
3. ボス情報を編集：
   - **名前**: ボスの名前
   - **ステータス**: HP (10-300)、Attack (10-200)、Defense (10-150)、Speed (10-150)、Magic (10-150)、Luck (0-100)
   - **ステータス合計上限**: 500（通常キャラクターより高い）
   - **説明**: ボスの説明文
   - **画像**: オリジナル画像をアップロード
   - **スプライト**: 自動生成またはカスタム
4. **「保存」**をクリック

**ボスのステータス範囲：**
- 通常キャラクターよりも高いステータス上限（合計500 vs 350）
- より強力なボスを作成可能
- レベルが上がるほど強力なステータスを設定することを推奨
- 画像はGoogle Driveに自動保存（オンラインモード時）

#### 5-4. 進行状況の確認

ストーリーモード画面で以下の情報を確認できます：

- **Current Level**: 現在挑戦可能なレベル
- **Completed**: クリア済みかどうか
- **Victories**: 撃破済みボスのリスト
- **Attempts**: 総挑戦回数
- **Last Played**: 最終プレイ日時

#### 5-5. ストーリーモードのリセット

進行状況をリセットして最初から挑戦し直すことができます。

1. ストーリーモード画面で**「Reset Progress」**をクリック
2. 確認ダイアログで「はい」を選択
3. 進行状況がLv1にリセットされる

---

## 統計と履歴

### 1. キャラクター統計

メイン画面のキャラクター一覧で確認できる情報：

- **Name**: キャラクター名
- **HP/ATK/DEF/SPD/MAG**: ステータス値
- **Battles**: 総戦闘数
- **Wins**: 勝利数と勝率

### 2. 全体統計

**「📊 View Statistics」**で確認できる情報：
- 登録キャラクター総数
- 総バトル数
- 平均ステータス値
- 最強キャラクターランキング

### 3. バトル履歴

**「🏟️ Battle History」**で確認できる情報：
- 過去20戦の詳細結果
- バトル時間と勝者
- ターン数と与ダメージ
- 詳細なターンログ

---

## トラブルシューティング

### よくある問題と対処法

#### 1. AIが画像を正しく分析できない

**症状：**
- ステータスが極端に低い
- エラーメッセージが表示される
- 分析が完了しない

**対処法：**
1. 画像の品質を確認
   - 解像度: 最低100x100px以上
   - フォーマット: PNG, JPEGを使用
   - 明瞭性: 線がはっきりしているか確認
2. キャラクターが画像の中央に描かれているか確認
3. 背景がシンプルか確認（白い紙推奨）
4. APIキーが正しく設定されているか確認

#### 2. バトルが開始できない

**症状：**
- 「START BATTLE」ボタンが反応しない
- エラーメッセージが表示される

**対処法：**
1. 両方のFighterが選択されているか確認
2. 同じキャラクター同士でないか確認
3. キャラクターデータが破損していないか確認（再登録を試す）

#### 3. バトル画面が表示されない

**症状：**
- Visual Modeが有効なのに画面が出ない
- バトルは完了するが表示されない

**対処法：**
1. Pygameライブラリが正しくインストールされているか確認
2. システムのグラフィックドライバーを更新
3. Visual Modeを無効にしてテスト

#### 4. アプリケーションが起動しない

**症状：**
- コマンド実行時にエラー
- 必要なライブラリが見つからない

**対処法：**
1. 仮想環境が有効化されているか確認
2. 必要な依存関係を再インストール：
   ```bash
   pip install -r requirements.txt
   ```
3. Pythonのバージョンが3.11以上か確認

### エラーログの確認

アプリケーションは詳細なログを`oekaki_battler.log`に記録します。
問題が発生した場合はこのファイルを確認してください。

### サポート

追加のサポートが必要な場合：
1. ログファイル内容を確認
2. 使用環境（OS、Pythonバージョン）を特定
3. 再現手順を整理

---

## FAQ

### Q1: どんな絵でも認識できますか？

**A:** AIは多様な描画スタイルに対応していますが、以下の条件で最良の結果が得られます：
- 明確な輪郭線
- 単純な背景
- 中央に配置されたキャラクター
- 十分な大きさ

### Q2: ステータスは手動で調整できますか？

**A:** 現在のバージョンでは、ステータスは自動生成のみです。将来のバージョンで手動調整機能を追加予定です。

### Q3: キャラクターを削除できますか？

**A:** はい、ただしバトル履歴があるキャラクターは削除できません。これはデータ整合性を保つためです。

### Q4: オフラインで使用できますか？

**A:** AI分析機能にはインターネット接続が必要です。一度登録したキャラクター同士のバトルはオフラインでも可能です。

### Q5: 複数のキャラクターを一度に登録できますか？

**A:** 現在は一体ずつの登録のみです。バッチ登録機能は将来のバージョンで検討中です。

### Q6: バトル速度を変更できますか？

**A:** バトルエンジンの設定でスピードを調整可能ですが、現在はコード変更が必要です。GUI設定は今後追加予定です。

### Q7: 保存されたデータの場所は？

**A:** キャラクターデータは`data/database.db`に、画像は`data/characters/`および`data/sprites/`に保存されます。

### Q8: 他の人とキャラクターを共有できますか？

**A:** データベースファイルと画像フォルダをコピーすることで共有可能です。将来的にはエクスポート/インポート機能を追加予定です。

---

## 更新履歴

- **v1.0.0**: 初回リリース
  - 基本的なキャラクター登録機能
  - AI分析システム
  - 自動バトル機能
  - 統計・履歴管理

---

**お絵描きバトラー**をお楽しみください！ 🎨⚔️